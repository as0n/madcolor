/*! madcolor 2014-07-24 */
madcolor=function(){function a(a){return Math.floor(Math.random()*a)}function b(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b}function c(){if(this.coefs=[],arguments[0]instanceof Array)this.coefs=arguments[0];else for(var a=0;a<arguments.length;a++)this.coefs.push(arguments[a])}function d(a,b,c){this.r=Math.min(Math.max(Math.round(a),0),255),this.g=Math.min(Math.max(Math.round(b),0),255),this.b=Math.min(Math.max(Math.round(c),0),255)}function e(a,b){function e(b){var c=b.toString();t.showHexCode&&(i.textContent=c),a.style.backgroundColor=c}function g(){d.list.shift(),d.list.push(d.random(t.colorRange)),u=c.fromColorList(d.list,w),q=new Date}function h(){var a=(new Date-q)/(1e3*t.colorPeriod),b=new d(u.r.calc(a),u.g.calc(a),u.b.calc(a)),c=b.toHSV(),f=c.h/360*p,g=(1-c.v)*o;if(e(b),t.showMap){imgdata=n.getImageData(0,0,p,o);for(var h=0;h<imgdata.data.length/4;h++)imgdata.data[4*h+3]=Math.max(0,imgdata.data[4*h+3]-10);n.clearRect(0,0,p,o),n.putImageData(imgdata,0,0),n.beginPath(),n.moveTo(r,s),n.lineTo(f,g),n.stroke()}r=f,s=g}var i,j,k,l,m,n,o,p,q,r,s,t={},u={r:null,g:null,b:null};b||(b={});for(var v in f)t[v]=void 0!==b[v]?b[v]:f[v].default;var w=Math.floor(t.listSize/2);if(t.showHexCode&&(i=document.createElement("p"),i.className="caption hexCode",a.appendChild(i)),t.showMap){var x=document.createElement("div");x.className="caption map",j=document.createElement("div"),j.id="canvaslist",x.appendChild(j),a.appendChild(x),o=j.clientHeight,p=j.clientWidth,k=document.createElement("canvas"),m=k.getContext("2d"),l=document.createElement("canvas"),n=l.getContext("2d"),l.height=k.height=o,l.width=k.width=p,n.fillStyle=n.strokeStyle="#ffffff",n.lineWidth=2,j.appendChild(k),j.appendChild(l);for(var y=0;p>y;y++)for(var z=0;o>z;z++){var A=Math.round(360*y/p),B=1-z/o;m.fillStyle=d.fromHSV(A,1,B).toString(),m.fillRect(y,z,1,1)}}for(;d.list.length<t.listSize;)d.list.push(d.random(t.colorRange));a.style.transitionDuration=t.displayPeriod+"s",g(),setInterval(g,1e3*t.colorPeriod),setInterval(h,1e3*t.displayPeriod)}var f={colorPeriod:{"default":2,attr:"mc-color-period",parser:parseFloat},displayPeriod:{"default":.2,attr:"mc-display-period",parser:parseFloat},listSize:{"default":5,attr:"mc-list-size",parser:parseInt},showMap:{"default":!0,attr:"mc-show-map",parser:function(a){return"true"===a?!0:"false"===a?!1:null}},showHexCode:{"default":!0,attr:"mc-show-hexcode",parser:function(a){return"true"===a?!0:"false"===a?!1:null}},colorRange:{"default":255,attr:"mc-color-range",parser:parseInt}};c.evaluate=function(a,b){return 0===a.length?0:a.shift()+b*c.evaluate(a,b)},c.lagrange=function(a){for(var b=new c,d=0;d<a.length;d++){for(var e=new c(1),f=a[d],g=0;g<a.length;g++){var h=a[g];if(g!=d){var i=new c(-h[0],1).lin(1/(f[0]-h[0]));e=e.mult(i)}}b=b.add(e.lin(f[1]))}return b},c.fromColorList=function(a,b){for(var d=[],e=[],f=[],g=0;g<a.length;g++)d.push([g-b,a[g].r]),e.push([g-b,a[g].g]),f.push([g-b,a[g].b]);return{r:c.lagrange(d),g:c.lagrange(e),b:c.lagrange(f)}},c.prototype.coef=function(a){return this.coefs[a]||0},c.prototype.calc=function(a){return c.evaluate(this.coefs.slice(),a)},c.prototype.add=function(a){for(var b=Math.max(this.coefs.length,a.coefs.length),d=[],e=0;b>e;e++)d.push(this.coef(e)+a.coef(e));return new c(d)},c.prototype.lin=function(a){for(var b=[],d=0;d<this.coefs.length;d++)b.push(a*this.coef(d));return new c(b)},c.prototype.mult=function(a){for(var b=this.coefs.length+a.coefs.length-1,d=[],e=0;b>e;e++){d[e]=0;for(var f=0;e>=f;f++)d[e]+=this.coef(f)*a.coef(e-f)}return new c(d)},d.list=[],d.random=function(b){return new d(a(b),a(b),a(b))},d.randomSat=function(){return d.fromHSV(a(360),1,1)},d.HSVMat=function(a,b,c){return[[a,b,0],[b,a,0],[0,a,b],[0,b,a],[b,0,a],[a,0,b]][c]},d.fromHSV=function(a,b,c){var e=c*b,f=c-e,g=a%360/60,h=e*(1-Math.abs(g%2-1)),i=d.HSVMat(e,h,Math.floor(g));return new d(Math.round(255*(i[0]+f)),Math.round(255*(i[1]+f)),Math.round(255*(i[2]+f)))},d.prototype.toString=function(){var a="#"+b(this.r)+b(this.g)+b(this.b);return(-1!=a.indexOf("-")||7!=a.length)&&console.error("r : "+this.r+" / g : "+this.g+" / b : "+this.b+" -> "+a),a},d.prototype.toHSV=function(){var a=Math.max(this.r,Math.max(this.g,this.b)),b=Math.min(this.r,Math.min(this.g,this.b)),c=a-b,d=a==this.r?(this.g-this.b)/c%6:a==this.g?(this.b-this.r)/c+2:(this.r-this.g)/c+4,e=60*d;return{h:(e+360)%360,s:c/a,v:a/255}};for(var g=document.getElementsByClassName("mc"),h=0;h<g.length;h++){var i,j=g[h],k={};for(var l in f)i=j.getAttribute(f[l].attr),i&&(k[l]=f[l].parser(i));e(g[h],k)}return e.color=d,e}();