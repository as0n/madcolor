/*! madcolor 2015-01-05 */
function Color(a,b,c){this.r=Math.borne(Math.round(a),0,255),this.g=Math.borne(Math.round(b),0,255),this.b=Math.borne(Math.round(c),0,255)}function Polynomial(){if(this.coefs=[],arguments[0]instanceof Array)this.coefs=arguments[0];else for(var a=0;a<arguments.length;a++)this.coefs.push(arguments[a])}Math.rand=function(a){return Math.floor(Math.random()*a)},Math.borne=function(a,b,c){return Math.min(Math.max(a,b),c)},Math.int2hex=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b},Color.random=function(a,b){var c=b-a;return new Color(a+Math.rand(c),a+Math.rand(c),a+Math.rand(c))},Color.randomSat=function(){return Color.fromHSV(Math.rand(360),1,1)},Color.HSVMat=function(a,b,c){return[[a,b,0],[b,a,0],[0,a,b],[0,b,a],[b,0,a],[a,0,b]][c]},Color.fromHSV=function(a,b,c){var d=c*b,e=c-d,f=a%360/60,g=d*(1-Math.abs(f%2-1)),h=Color.HSVMat(d,g,Math.floor(f));return new Color(Math.round(255*(h[0]+e)),Math.round(255*(h[1]+e)),Math.round(255*(h[2]+e)))},Color.prototype.toString=function(){var a="#"+Math.int2hex(this.r)+Math.int2hex(this.g)+Math.int2hex(this.b);return a},Color.prototype.toHSV=function(){var a=Math.max(this.r,Math.max(this.g,this.b)),b=Math.min(this.r,Math.min(this.g,this.b)),c=a-b,d=a==this.r?(this.g-this.b)/c%6:a==this.g?(this.b-this.r)/c+2:(this.r-this.g)/c+4,e=60*d;return{h:(e+360)%360,s:c/a,v:a/255}},Polynomial.evaluate=function(a,b){return 0===a.length?0:a.shift()+b*Polynomial.evaluate(a,b)},Polynomial.lagrange=function(a){for(var b,c,d,e=new Polynomial,f=0;f<a.length;f++){b=new Polynomial(1),d=a[f];for(var g=0;g<a.length;g++)c=a[g],g!=f&&(b=b.mult(new Polynomial(-c[0],1).lin(1/(d[0]-c[0]))));e=e.add(b.lin(d[1]))}return e},Polynomial.prototype.coef=function(a){return this.coefs[a]||0},Polynomial.prototype.calc=function(a){return Polynomial.evaluate(this.coefs.slice(),a)},Polynomial.prototype.add=function(a){for(var b=Math.max(this.coefs.length,a.coefs.length),c=[],d=0;b>d;d++)c.push(this.coef(d)+a.coef(d));return new Polynomial(c)},Polynomial.prototype.lin=function(a){for(var b=[],c=0;c<this.coefs.length;c++)b.push(a*this.coef(c));return new Polynomial(b)},Polynomial.prototype.mult=function(a){for(var b=this.coefs.length+a.coefs.length-1,c=[],d=0;b>d;d++){c[d]=0;for(var e=0;d>=e;e++)c[d]+=this.coef(e)*a.coef(d-e)}return new Polynomial(c)},Polynomial.prototype.deriv=function(){return new Polynomial(this.coefs.slice(1))},Polynomial.prototype.int=function(a){for(var b=[a],c=0;c<this.coefs.length;c++)b.push(this.coefs[c]);return new Polynomial(b)},madcolor=function(){function a(a,b){function d(b){var c=b.toString();r.showHexCode&&(g.textContent=c),a.style.backgroundColor=c}function e(){Color.list.shift(),Color.list.push(Color.random(r.colorRangeMin,r.colorRangeMax)),s=Polynomial.fromColorList(Color.list,u),o=new Date}function f(){var a=(new Date-o)/(1e3*r.colorPeriod),b=new Color(s.r.calc(a),s.g.calc(a),s.b.calc(a));if(d(b),r.showMap){for(var c=l.getImageData(0,0,n,m),e=b.toHSV(),g=e.h/360*n,h=(1-e.v)*m,i=0;i<c.data.length/4;i++)c.data[4*i+3]=Math.max(0,c.data[4*i+3]-10);l.clearRect(0,0,n,m),l.putImageData(c,0,0),l.beginPath(),l.moveTo(p,q),l.lineTo(g,h),l.stroke(),p=g,q=h}window.requestAnimationFrame(f)}var g,h,i,j,k,l,m,n,o,p,q,r={},s={r:null,g:null,b:null};b||(b={});for(var t in c)r[t]=void 0!==b[t]?b[t]:c[t].default;var u=Math.floor(r.listSize/2);if(r.showHexCode&&(g=document.createElement("p"),g.className="caption hexCode",a.appendChild(g)),r.showMap){var v=document.createElement("div");v.className="caption map",h=document.createElement("div"),h.id="canvaslist",v.appendChild(h),a.appendChild(v),m=h.clientHeight,n=h.clientWidth,i=document.createElement("canvas"),k=i.getContext("2d"),j=document.createElement("canvas"),l=j.getContext("2d"),j.height=i.height=m,j.width=i.width=n,l.fillStyle=l.strokeStyle="#ffffff",l.lineWidth=2,h.appendChild(i),h.appendChild(j);for(var w=0;n>w;w++)for(var x=0;m>x;x++){var y=Math.round(360*w/n),z=1-x/m;k.fillStyle=Color.fromHSV(y,1,z).toString(),k.fillRect(w,x,1,1)}}for(;Color.list.length<r.listSize;)Color.list.push(Color.random(r.colorRangeMin,r.colorRangeMax));e(),setInterval(e,1e3*r.colorPeriod),window.requestAnimationFrame(f)}var b=function(a){return"true"===a?!0:"false"===a?!1:null},c={colorPeriod:{"default":2,attr:"mc-color-period",parser:parseFloat},listSize:{"default":5,attr:"mc-list-size",parser:parseInt},showMap:{"default":!0,attr:"mc-show-map",parser:b},showHexCode:{"default":!0,attr:"mc-show-hexcode",parser:b},colorRangeMax:{"default":255,attr:"mc-color-range-max",parser:parseInt},colorRangeMin:{"default":0,attr:"mc-color-range-min",parser:parseInt}};Color.list=[],Polynomial.fromColorList=function(a,b){for(var c=[],d=[],e=[],f=0;f<a.length;f++)c.push([f-b,a[f].r]),d.push([f-b,a[f].g]),e.push([f-b,a[f].b]);return{r:Polynomial.lagrange(c),g:Polynomial.lagrange(d),b:Polynomial.lagrange(e)}};for(var d=document.getElementsByClassName("mc"),e=0;e<d.length;e++){var f,g=d[e],h={};for(var i in c)f=g.getAttribute(c[i].attr),f&&(h[i]=c[i].parser(f));a(d[e],h)}return a.color=Color,a}();